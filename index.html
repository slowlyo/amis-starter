<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <title>Amis Starter - ä½ä»£ç å‰ç«¯æ¡†æ¶</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1"
    />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta name="description" content="åŸºäºamisçš„ä½ä»£ç å‰ç«¯åº”ç”¨å¿«é€Ÿå¯åŠ¨æ¨¡æ¿" />

    <!-- amis SDK æ ·å¼æ–‡ä»¶ -->
    <link rel="stylesheet" href="/js/sdk/sdk.css" />
    <link rel="stylesheet" href="/js/sdk/helper.css" />
    <link rel="stylesheet" href="/js/sdk/iconfont.css" />

    <!-- amis SDK è„šæœ¬æ–‡ä»¶ -->
    <script src="/js/sdk/sdk.js"></script>

    <!-- è·¯ç”±æ”¯æŒ -->
    <script src="https://unpkg.com/history@4.10.1/umd/history.js"></script>

    <style>
      html,
      body,
      .app-wrapper {
        position: relative;
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      }

      /* åŠ è½½åŠ¨ç”» */
      .loading {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        font-size: 16px;
        color: #666;
      }

      .loading::after {
        content: '';
        width: 20px;
        height: 20px;
        margin-left: 10px;
        border: 2px solid #f3f3f3;
        border-top: 2px solid #007bff;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
    </style>
  </head>
  <body>
    <div id="root" class="app-wrapper">
      <div class="loading">æ­£åœ¨åŠ è½½åº”ç”¨...</div>
    </div>

    <script type="text/javascript">
      (function () {
        // æ£€æŸ¥ä¾èµ–æ˜¯å¦åŠ è½½å®Œæˆ
        if (typeof amisRequire === 'undefined') {
          document.getElementById('root').innerHTML =
            '<div style="text-align: center; padding: 50px; color: #e74c3c;">' +
            '<h2>âŒ åŠ è½½å¤±è´¥</h2>' +
            '<p>amis SDK æœªæ­£ç¡®åŠ è½½ï¼Œè¯·è¿è¡Œ <code>npm run init</code> åˆå§‹åŒ–èµ„æº</p>' +
            '</div>';
          return;
        }

        let amis = amisRequire('amis/embed');

        // åˆ›å»ºè·¯ç”±å†å²å¯¹è±¡
        const history = window.History ? History.createHashHistory() : null;

        // åº”ç”¨é…ç½®
        const app = {
          type: 'app',
          brandName: 'ç®¡ç†ç³»ç»Ÿ',

          // ä½¿ç”¨APIè·å–é¡µé¢é…ç½®
          api: '/pages/site.json'
        };

        // è·¯ç”±å¤„ç†å‡½æ•°
        function normalizeLink(to, location = history?.location || window.location) {
          to = to || '';
          if (to && to[0] === '#') {
            to = location.pathname + location.search + to;
          } else if (to && to[0] === '?') {
            to = location.pathname + to;
          }
          return to;
        }

        function isCurrentUrl(to) {
          if (!to || !history) return false;
          const pathname = history.location.pathname;
          return pathname === to || pathname === to.replace('#', '');
        }

        // æ¸²æŸ“åº”ç”¨
        let amisInstance = amis.embed(
          '#root',
          app,
          {
            location: history?.location || { pathname: '/' },
            data: {
              // å…¨å±€æ•°æ®
            },
            context: {
              // å…¨å±€ä¸Šä¸‹æ–‡
              API_HOST: 'https://3xsw4ap8wah59.cfc-execute.bj.baidubce.com'
            }
          },
          {
            updateLocation: (location, replace) => {
              if (!history) return;
              location = normalizeLink(location);
              if (location === 'goBack') {
                return history.goBack();
              }
              history[replace ? 'replace' : 'push'](location);
            },
            jumpTo: (to, action) => {
              if (to === 'goBack' && history) {
                return history.goBack();
              }

              to = normalizeLink(to);

              if (action && action.actionType === 'url') {
                action.blank === false
                  ? (window.location.href = to)
                  : window.open(to, '_blank');
                return;
              } else if (action && action.blank) {
                window.open(to, '_blank');
                return;
              }

              if (/^https?:\/\//.test(to)) {
                window.location.href = to;
              } else if (history) {
                history.push(to);
              }
            },
            isCurrentUrl: isCurrentUrl,
            theme: 'cxd'
          }
        );

        // ç›‘å¬è·¯ç”±å˜åŒ–
        if (history) {
          history.listen(state => {
            amisInstance.updateProps({
              location: state.location || state
            });
          });
        }

        console.log('ğŸ‰ Amis Starter åº”ç”¨å¯åŠ¨æˆåŠŸï¼');
      })();
    </script>
  </body>
</html>